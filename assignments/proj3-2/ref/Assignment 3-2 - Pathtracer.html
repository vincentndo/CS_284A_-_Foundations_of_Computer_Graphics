<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>cs184/284a</title><meta charset="UTF-8"><meta http-equiv="Content-Language" content="en"><link rel="stylesheet" href="Assignment%203-2%20-%20Pathtracer_files/ionicons.css">
<link rel="stylesheet" href="Assignment%203-2%20-%20Pathtracer_files/cs184-web-5d805804.css">
<link rel="stylesheet" href="Assignment%203-2%20-%20Pathtracer_files/katex.css">
<link rel="stylesheet" href="Assignment%203-2%20-%20Pathtracer_files/github-markdown.css">
<link rel="stylesheet" href="Assignment%203-2%20-%20Pathtracer_files/github.css"><style type="text/css">date-input-polyfill{background:#fff;color:#000;text-shadow:none;border:0;padding:0;height:auto;width:auto;line-height:normal;font-family:sans-serif;font-size:14px;position:absolute!important;text-align:center;box-shadow:0 3px 10px 1px rgba(0,0,0,.22);cursor:default;z-index:1;border-radius:5px;-moz-border-radius:5px;-webkit-border-radius:5px;overflow:hidden;display:block}date-input-polyfill[data-open=false]{visibility:hidden;z-index:-100!important;top:0}date-input-polyfill[data-open=true]{visibility:visible}date-input-polyfill select,date-input-polyfill table,date-input-polyfill td,date-input-polyfill th{background:#fff;color:#000;text-shadow:none;border:0;padding:0;height:auto;width:auto;line-height:normal;font-family:sans-serif;font-size:14px;box-shadow:none;font-family:Lato,Helvetica,Arial,sans-serif}date-input-polyfill button,date-input-polyfill select{border:0;border-radius:0;border-bottom:1px solid #dadfe1;height:24px;vertical-align:top;-webkit-appearance:none;-moz-appearance:none}date-input-polyfill .monthSelect-wrapper{width:55%;display:inline-block}date-input-polyfill .yearSelect-wrapper{width:25%;display:inline-block}date-input-polyfill select{width:100%}date-input-polyfill select:first-of-type{border-right:1px solid #dadfe1;border-radius:5px 0 0 0;-moz-border-radius:5px 0 0 0;-webkit-border-radius:5px 0 0 0}date-input-polyfill button{width:20%;background:#dadfe1;border-radius:0 5px 0 0;-moz-border-radius:0 5px 0 0;-webkit-border-radius:0 5px 0 0}date-input-polyfill button:hover{background:#eee}date-input-polyfill table{border-collapse:separate!important;border-radius:0 0 5px 5px;-moz-border-radius:0 0 5px 5px;-webkit-border-radius:0 0 5px 5px;overflow:hidden;max-width:280px;width:280px}date-input-polyfill td,date-input-polyfill th{width:32px;padding:4px;text-align:center;box-sizing:content-box}date-input-polyfill td[data-day]{cursor:pointer}date-input-polyfill td[data-day]:hover{background:#dadfe1}date-input-polyfill [data-selected]{font-weight:700;background:#d8eaf6}</style></head><body><script>$MG={"o":{"browserRefresh":false,"activeSemester":{"id":3,"tag":"sp20"},"auth":{"profile":{"id":14899769,"username":"vincentndo","avatar_url":"https://avatars3.githubusercontent.com/u/14899769?v=4"},"user":{"id":3600,"sid":25949105,"email":"ninhdo@berkeley.edu","roster_name":"Do, Ninh","role":"student","semester_id":3,"profile_id":14899769}},"semester":{"id":3,"tag":"sp20"}},"$$":[{"l":["auth","user","created_at"],"r":{"type":"Date","value":1579677917000}},{"l":["auth","user","updated_at"],"r":{"type":"Date","value":1580524748000}}]}</script><div id="app-root"><div class="rel" id="app-page"><header class="rel" id="app-header"><div><nav><a href="https://cs184.eecs.berkeley.edu/sp20" class="">cs184/284a</a><a href="https://cs184.eecs.berkeley.edu/sp20/policies" class="">policies</a><a href="https://cs184.eecs.berkeley.edu/sp20/staff" class="">staff</a><a href="https://cs184.eecs.berkeley.edu/sp20/readings" class="">readings</a><a href="https://cs184.eecs.berkeley.edu/sp20/resources" class="">resources</a></nav><div class="header-tail"><div class="header-auth"><a href="https://cs184.eecs.berkeley.edu/auth/logout?r=/sp20" class="nav-link"><i class="icon ion-ios-log-out"></i></a><a href="https://cs184.eecs.berkeley.edu/sp20/p/vincentndo" class="profile"><span class="avatar"><img src="Assignment%203-2%20-%20Pathtracer_files/14899769.jpeg"></span><span class="username">vincentndo</span></a></div></div></div></header><div class="full" id="app-page__body"><div class="article"><div class="article-header"><h1>Assignment 3-2: Pathtracer</h1></div><div class="article-body"><div class="comp-md markdown-body"><p>
<img src="Assignment%203-2%20-%20Pathtracer_files/21_1.jpg" width="800px">
</p>
<h2>Deadlines</h2>
<table>
<thead>
<tr>
<th style="text-align:center"><span style="font-weight:normal"><a href="https://www.gradescope.com/courses/83189">Checkpoint Quiz</a></span></th>
<th style="text-align:center"><strong>Tuesday 03/31, 11:59PM</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><span style="font-weight:normal">Assignment 3-2</span></td>
<td style="text-align:center"><strong>Friday 04/03, 11:59PM</strong></td>
</tr>
</tbody>
</table>
<p>With the current semester's modifications to the policy in light of recent events, you have a total of <em>8 slip days</em>
 to use on assignments throughout the semester. You do not have slip 
days for checkpoint quizzes. Assignments submitted after 11:59PM are 
considered a full day late. There are no late minutes or late hours. 
After you have used all 8 slip days, you will lose 10% for each day you 
submit an assignment late.</p>
<p>Note the Friday due date, and the fact that the checkpoint date has 
been pushed back until after Spring Break. You may still wish to start 
the project before Spring Break, as rendering and the writeup can take 
some time.</p>
<p>Your final assignment submission must include <strong>both</strong> your code and write-up. Please consult this article on <a href="https://cs184.eecs.berkeley.edu/sp20/article/15/submitting-cs184-assignments">how to submit assignments for CS184</a>.</p>
<h2>Overview</h2>
<p>In this project, you will add additional features to your ray tracer 
from Project 3-1, such as more complicated materials, environment 
lights, or depth of field effects.</p>
<p><strong>NOTE: For this project, you will choose TWO out of the four 
given parts to complete. One of those parts must be Part 1 or Part 2. In
 other words, you can choose any combination of two parts except the 
pair (Part 3, Part 4).</strong></p>
<p>This project will be shorter than 3-1, but rendering may still take 
some time. Please plan accordingly and leave time for renders/writeup. 
Start early!</p>
<h2>Project Parts</h2>
<p>Once again, you must choose TWO of the following parts, and one of 
those parts must be either Part 1 or Part 2. However, if you'd like to 
complete three, or all four parts, please do so! This project is one of 
the most rewarding to complete fully, as you'll be able to render almost
 anything at the end: all sorts of fancy materials in different 
environments, with any camera angle and focus depth.</p>
<ul>
<li>Part 1: <a href="https://cs184.eecs.berkeley.edu/sp20/article/30/assignment-3-2-part-1">Mirror and Glass Materials</a></li>
<li>Part 2: <a href="https://cs184.eecs.berkeley.edu/sp20/article/31/assignment-3-2-part-2">Microfacet Material</a></li>
<li>Part 3: <a href="https://cs184.eecs.berkeley.edu/sp20/article/32/assignment-3-2-part-3">Environment Light</a></li>
<li>Part 4: <a href="https://cs184.eecs.berkeley.edu/sp20/article/33/assignment-3-2-part-4">Depth of Field</a></li>
</ul>
<h2>Getting Started</h2>
<p>Accept the assignment through the website, and clone from your private repo using the command:</p>
<pre><code>git clone &lt;YOUR_PRIVATE_REPO&gt;
</code></pre>
<p>As before, refer to this <a href="https://cs184.eecs.berkeley.edu/sp20/article/11/building-cs184-assignments">how to build cs184 projects</a> document to build your project.</p>
<p>Please consult the <a href="https://cs184.eecs.berkeley.edu/sp20/article/20/assignment-3-1-pathtracer">project 3-1 spec</a> for details on the user interface. Here are some old and new command line flags you'll want to pay attention to:</p>
<ul>
<li><code>-e some_map.exr</code> loads an environment light <em>.exr</em> image file (part 3)</li>
<li><code>-b 1.23</code> sets the lens radius to 1.23 (part 4)</li>
<li><code>-d 4.56</code> sets the focal distance to 4.56 (part 4)</li>
</ul>
<p>Please consider using the CGL Vectors Library to write all your math 
computations to simplify your code &amp; ensure correctness. You can 
read the documentation of this library <a href="https://cs184.eecs.berkeley.edu/sp20/article/28/cgl-vectors-library-documentatio">here</a></p>
<p>A new mouse interaction:</p>
<ul>
<li>In render mode, after thin lens has been implemented, you can right 
click on a part of the image and automatically set the appropriate focal
 distance (autofocus). This is already done for people using pre-built 
binaries. For people using their own 3-1 code, you need to add this 
function to your pathtracer.cpp:</li>
</ul>
<pre><code>void PathTracer::autofocus(Vector2D loc) {
  Ray r = camera-&gt;generate_ray(loc.x / sampleBuffer.w, loc.y / sampleBuffer.h);
  Intersection isect;
  bvh-&gt;intersect(r, &amp;isect);
  camera-&gt;focalDistance = isect.t;
}
</code></pre>
<p>As well as two new keyboard commands:</p>
<ul>
<li><kbd>k</kbd> | <kbd>l</kbd>: Increase/Decrease the camera lens radius</li>
<li><kbd>;</kbd> | <kbd>'</kbd>: Increase/Decrease the focal distance</li>
</ul>
<p>Also please use the "cell render" mode to debug, where you can 
interactively click and drag to select a small region of the screen to 
be rendered. Press <kbd>c</kbd> (after pressing <kbd>r</kbd>) to toggle this mode in the GUI.</p>
<h2>Integrating Previous Code</h2>
<p>For Project 3-2, you will need a working implentation of Project 3-1.
 You have the option of either porting your code from Project 3-1, or 
using pre-compiled binaries generated from the staff solution.</p>
<h3>Using Your Own 3-1 Code</h3>
<p>To use your own code, set the build option BUILD_CUSTOM to ON in <em>CMakeLists.txt</em>. Then, you'll need to copy over the following files from your previous assignment, and place them in your <em>src/</em> directory.</p>
<ul>
<li>src/scene/sphere.cpp</li>
<li>src/scene/triangle.cpp</li>
<li>src/scene/light.cpp</li>
<li>src/scene/bvh.cpp</li>
<li>src/scene/bbox.cpp</li>
<li>src/pathtracer/camera.cpp</li>
<li>src/pathtracer/bsdf.cpp</li>
<li>src/pathtracer/pathtracer.cpp</li>
</ul>
<p>Additionally, you will need to delete all the functions under part 3-2 code in your <em>bsdf.cpp</em>. This includes functions:</p>
<ul>
<li><code>Spectrum MirrorBSDF::f(const Vector3D &amp;wo, const Vector3D &amp;wi)</code></li>
<li><code>Spectrum MirrorBSDF::sample_f(const Vector3D &amp;wo, Vector3D *wi, float *pdf)</code></li>
<li><code>Spectrum GlossyBSDF::f(const Vector3D &amp;wo, const Vector3D &amp;wi)</code></li>
<li><code>Spectrum GlossyBSDF::sample_f(const Vector3D &amp;wo, Vector3D *wi, float *pdf)</code></li>
<li><code>Spectrum RefractionBSDF::f(const Vector3D &amp;wo, const Vector3D &amp;wi)</code></li>
<li><code>Spectrum RefractionBSDF::sample_f(const Vector3D &amp;wo, Vector3D *wi, float *pdf)</code></li>
<li><code>Spectrum GlassBSDF::f(const Vector3D &amp;wo, const Vector3D &amp;wi)</code></li>
<li><code>Spectrum GlassBSDF::sample_f(const Vector3D &amp;wo, Vector3D *wi, float *pdf)</code></li>
<li><code>void BSDF::reflect(const Vector3D &amp;wo, Vector3D *wi)</code></li>
<li><code>bool BSDF::refract(const Vector3D &amp;wo, Vector3D *wi, float ior)</code></li>
</ul>
<h3>Using the Staff Library (Default settings)</h3>
<p>The project has been configured to default to this settings. If you 
just cloned the repository, you can directly start building &amp; 
writing code. You can also use this to check / compare your own project 
3-1 solution.</p>
<p>To use the provided library, set the build option BUILD_CUSTOM to OFF (Default) in <em>CMakeLists.txt</em>.
 This will tell the generated makefiles to ignore your project 3-1 code,
 and include the library that matches your system instead. Note that the
 staff binary will generate a watermark on the corner of your image.</p>
<h2>Writeup Guidelines</h2>
<p>As in all previous projects, this project will require a writeup 
hosted on github classroom, and a pdf submitted to Gradescope. The goals
 of your write-up are for you to (a) think about and articulate what 
you've built and learned in your own words, (b) have a write-up of the 
project to take away from the class.  Your write-up should include:</p>
<ul>
<li>An overview of the project, your approach to the various parts, what
 problems you encountered and how you solved them. Strive for clarity 
and succinctness.</li>
<li>For each of the two (or more!) Parts you chose, make sure to include
 the specific results described at the end of each Part's spec. In 
addition to these generated images, make sure you include a short but 
clear summary of your implementation, as well as an explanation for why 
your images look the way they do, and the comparisons between them. If 
you failed to generate any results correctly, provide a brief 
explanation of why.</li>
<li>Clearly indicate any extra credit items you completed, and provide a good write-up and illustration.</li>
</ul>
<p>The writeup is our main method of evaluating your work, so it is 
important to spend the time to do it correctly.  Plan ahead to allocate 
time for the writeup well before the deadline.</p>
<p>Please do not just copy-paste words from the spec or lecture. 
Instead, try to connect the high level concepts expressed here with the 
actual programming you've done!</p>
<p>Here's another link to <a href="https://cs184.eecs.berkeley.edu/sp20/article/15/submitting-cs184-assignments">how to submit assignments for CS184</a>.</p>
<h3>Details</h3>
<p>Do not convert or resize your <em>.png</em>. files. Use either the command line rendering mode or the <code>S</code>
 key to save screenshots, not your own OS's utility (like Project 1 and 
3-1 but not like Project 2). Keep your images in a subdirectory called <code>images/</code> in the <code>docs/</code> directory. We recommend using the <code>-r 480 360</code> command line flag to set resolution at 480 by 360 for your screenshots.</p>
<p>Please also make sure that your writeup indicates clearly which two (or more!) parts you chose.</p>
<h2>Final Note</h2>
<p>As mentioned earlier, each of the parts of this project gives you 
something to work with, and if you finish all of Project 3-2, you can 
basically render anything. When you're done, feel free to show it off! 
Make some fancy scenes and materials, or play with the lens! Again, be 
creative!</p>
</div></div></div></div><footer id="app-footer"></footer></div></div><script src="Assignment%203-2%20-%20Pathtracer_files/cs184-web-a8fbc5e3.js"></script>
<script>$_mod_cal184.ready();</script><date-input-polyfill data-open="false"><span class="yearSelect-wrapper"><select class="yearSelect"><option value="1890" selected="selected">1890</option><option value="1891">1891</option><option value="1892">1892</option><option value="1893">1893</option><option value="1894">1894</option><option value="1895">1895</option><option value="1896">1896</option><option value="1897">1897</option><option value="1898">1898</option><option value="1899">1899</option><option value="1900">1900</option><option value="1901">1901</option><option value="1902">1902</option><option value="1903">1903</option><option value="1904">1904</option><option value="1905">1905</option><option value="1906">1906</option><option value="1907">1907</option><option value="1908">1908</option><option value="1909">1909</option><option value="1910">1910</option><option value="1911">1911</option><option value="1912">1912</option><option value="1913">1913</option><option value="1914">1914</option><option value="1915">1915</option><option value="1916">1916</option><option value="1917">1917</option><option value="1918">1918</option><option value="1919">1919</option><option value="1920">1920</option><option value="1921">1921</option><option value="1922">1922</option><option value="1923">1923</option><option value="1924">1924</option><option value="1925">1925</option><option value="1926">1926</option><option value="1927">1927</option><option value="1928">1928</option><option value="1929">1929</option><option value="1930">1930</option><option value="1931">1931</option><option value="1932">1932</option><option value="1933">1933</option><option value="1934">1934</option><option value="1935">1935</option><option value="1936">1936</option><option value="1937">1937</option><option value="1938">1938</option><option value="1939">1939</option><option value="1940">1940</option><option value="1941">1941</option><option value="1942">1942</option><option value="1943">1943</option><option value="1944">1944</option><option value="1945">1945</option><option value="1946">1946</option><option value="1947">1947</option><option value="1948">1948</option><option value="1949">1949</option><option value="1950">1950</option><option value="1951">1951</option><option value="1952">1952</option><option value="1953">1953</option><option value="1954">1954</option><option value="1955">1955</option><option value="1956">1956</option><option value="1957">1957</option><option value="1958">1958</option><option value="1959">1959</option><option value="1960">1960</option><option value="1961">1961</option><option value="1962">1962</option><option value="1963">1963</option><option value="1964">1964</option><option value="1965">1965</option><option value="1966">1966</option><option value="1967">1967</option><option value="1968">1968</option><option value="1969">1969</option><option value="1970">1970</option><option value="1971">1971</option><option value="1972">1972</option><option value="1973">1973</option><option value="1974">1974</option><option value="1975">1975</option><option value="1976">1976</option><option value="1977">1977</option><option value="1978">1978</option><option value="1979">1979</option><option value="1980">1980</option><option value="1981">1981</option><option value="1982">1982</option><option value="1983">1983</option><option value="1984">1984</option><option value="1985">1985</option><option value="1986">1986</option><option value="1987">1987</option><option value="1988">1988</option><option value="1989">1989</option><option value="1990">1990</option><option value="1991">1991</option><option value="1992">1992</option><option value="1993">1993</option><option value="1994">1994</option><option value="1995">1995</option><option value="1996">1996</option><option value="1997">1997</option><option value="1998">1998</option><option value="1999">1999</option><option value="2000">2000</option><option value="2001">2001</option><option value="2002">2002</option><option value="2003">2003</option><option value="2004">2004</option><option value="2005">2005</option><option value="2006">2006</option><option value="2007">2007</option><option value="2008">2008</option><option value="2009">2009</option><option value="2010">2010</option><option value="2011">2011</option><option value="2012">2012</option><option value="2013">2013</option><option value="2014">2014</option><option value="2015">2015</option><option value="2016">2016</option><option value="2017">2017</option><option value="2018">2018</option><option value="2019">2019</option><option value="2020">2020</option><option value="2021">2021</option><option value="2022">2022</option><option value="2023">2023</option><option value="2024">2024</option><option value="2025">2025</option><option value="2026">2026</option><option value="2027">2027</option><option value="2028">2028</option><option value="2029">2029</option><option value="2030">2030</option><option value="2031">2031</option><option value="2032">2032</option><option value="2033">2033</option><option value="2034">2034</option><option value="2035">2035</option><option value="2036">2036</option><option value="2037">2037</option><option value="2038">2038</option><option value="2039">2039</option><option value="2040">2040</option></select></span><span class="monthSelect-wrapper"><select class="monthSelect"></select></span><button>Today</button><table><thead></thead><tbody></tbody></table></date-input-polyfill><script>(function(){var w=window;w.$components=(w.$components||[]).concat({"r":"M","w":[["s0-0-0-3-9",0,{"to":"/resources","l":"resources"},{"f":1,"s":{"active":false},"w":{"target":"/sp20/resources"}}],["s0-0-0-3-8",0,{"to":"/readings","l":"readings"},{"f":1,"s":{"active":false},"w":{"target":"/sp20/readings"}}],["s0-0-0-3-7",0,{"to":"/staff","l":"staff"},{"f":1,"s":{"active":false},"w":{"target":"/sp20/staff"}}],["s0-0-0-3-6",0,{"to":"/policies","l":"policies"},{"f":1,"s":{"active":false},"w":{"target":"/sp20/policies"}}],["s0-0-0-3-5",0,{"to":"/","l":"cs184/284a"},{"f":1,"s":{"active":false},"w":{"target":"/sp20"}}]],"t":["/cal-184-website$3.2.0/client/components/comp-nav-link/index.marko"]})||w.$components})()</script></body></html>